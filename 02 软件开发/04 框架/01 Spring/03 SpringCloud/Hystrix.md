# Hystrix

## 概念

Hystrix是一个用于处理分布式系统的延迟和容错的开源库，在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等等，Hystrix能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。

## 降级

服务繁忙，需要使用备选方案。

## 熔断

下游服务调用异常，需要立即熔断，使用降级方案。

熔断机制是应对雪崩效用的一种微服务链路保护机制。当链路中的某个微服务出错不可用或者响应时间太长时，会进行服务的降级，进而熔断该节点微服务的调用，快速返回错误的响应信息。

当检测到该节点微服务调用响应正常后，恢复调用链路。

## 限流

对服务进行限制并发访问。

## 隔离策略

### 线程池隔离

它会为每一个Hystrix命令创建一个独立的线程池，不同服务通过使用不同线程池，彼此间将不受影响，这样就算某个在Hystrix命令包装下的依赖服务出现延迟过高的情况，也只是对该依赖服务的调用产生影响，而不会拖慢其他的服务。
这种方式需要为每个依赖的服务申请线程池，有一定的资源消耗；通过线程池大小可以控制并发量，当线程池饱和时可以提前拒绝服务,防止依赖问题扩散。建议线程池不要设置过大，否则大量堵塞线程有可能会拖慢服务器。

### 信号量隔离

实现方式是使用一个原子计数器（或信号量）来记录当前有多少个线程在运行，请求过来了，先判断计数器的数值，若超过设置的最大线程个数则丢弃该类型的新请求，若不超过则执行计数操作请求来计数器+1。

隔离线程与业务线程是同一个。